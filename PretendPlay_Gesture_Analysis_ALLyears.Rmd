---
title: "PretendPlay_Gesture_Analysis_ALLyears"
author: "Kristen Johnson"
date: "2025-04-25"
output:
  pdf_document: default
  html_document: default
---

```{r, echo=FALSE}
# Install required packages if you don't have them
# Remove the comment symbols (#) to run these lines
# install.packages("tidyverse")
 #install.packages("car")
 #install.packages("effectsize")
 #install.packages("rstatix")
#install.packages("e1071")
# Load required package if needed
# install.packages("rstatix")

# Load necessary packages
library(tidyverse)
library(car)       # For Levene's test and Type III SS
library(effectsize) # For effect sizes
library(rstatix)    # For convenient statistical functions
library(here)
library(extrafont)  # Ensures Times New Roman is available
library(e1071)
library(rstatix)
```

# Read in each dataset and add Year column
```{r}
child_summary_H10 <- read_csv(here("PN_Datasets", "Pretend_Play", "CSVs_of_Combined_Data_PP", "child_summary_H10.csv"))
child_summary_H10$Year <- 10

child_summary_H8 <- read_csv(here("PN_Datasets", "Pretend_Play", "CSVs_of_Combined_Data_PP", "child_summary_H8.csv"))
child_summary_H8$Year <- 8

child_summary_H7 <- read_csv(here("PN_Datasets", "Pretend_Play", "CSVs_of_Combined_Data_PP", "child_summary_H7.csv"))
child_summary_H7$Year <- 7
```

# Combine data across ALL THREE YEARS
```{r}
# Combine all datasets into one data frame
pp_gesture_data_ALLyears <- bind_rows(child_summary_H10, child_summary_H8, child_summary_H7)

# View the combined dataset
head(pp_gesture_data_ALLyears)
```

Check for Skewness
```{r}
 #Calculate skewness
skewness(completely_merged_data_ALLyears$rep_gestures, na.rm = TRUE)

# Histogram of rep_gestures
ggplot(completely_merged_data_ALLyears, aes(x = rep_gestures)) +
  geom_histogram(binwidth = 1, fill = "gray80", color = "black") +
  labs(
    title = "Distribution of Representational Gesture Counts",
    x = "Number of Representational Gestures",
    y = "Count of Participants"
  ) +
  theme_minimal(base_size = 14, base_family = "Times New Roman") +
  theme(
    panel.border = element_rect(color = "black", fill = NA),
    plot.title = element_text(face = "bold", hjust = 0.5),
    axis.title = element_text(face = "bold")
  )

```

#bc highly skewed, ruyn Mann-Whitney instead of ANOVA:
```{r}
# Step 1: Run the Mann-Whitney U test properly
mw_result <- wilcox.test(rep_gestures ~ groupstatus, 
                         data = completely_merged_data_ALLyears, 
                         exact = FALSE)

# View the output if you want
print(mw_result)

# Step 2: Calculate total N
n1 <- completely_merged_data_ALLyears %>%
  filter(groupstatus == "TD") %>%
  nrow()

n2 <- completely_merged_data_ALLyears %>%
  filter(groupstatus == "PL") %>%
  nrow()

N <- n1 + n2

# Step 3: Approximate Z from p-value
# p.value comes from mw_result
z_approx <- qnorm(mw_result$p.value / 2, lower.tail = FALSE)

# Step 4: Calculate r
r_effect_size <- z_approx / sqrt(N)

# Step 5: Print result
cat("Mann-Whitney U result: W =", mw_result$statistic, 
    ", p =", signif(mw_result$p.value, 3), 
    ", r =", round(r_effect_size, 2), "\n")

```

# same for total gestures
```{r}
# Step 1: Run the Mann-Whitney U test properly
mw_result <- wilcox.test(total_gestures ~ groupstatus, 
                         data = completely_merged_data_ALLyears, 
                         exact = FALSE)

# View the output if you want
print(mw_result)

# Step 2: Calculate total N
n1 <- completely_merged_data_ALLyears %>%
  filter(groupstatus == "TD") %>%
  nrow()

n2 <- completely_merged_data_ALLyears %>%
  filter(groupstatus == "PL") %>%
  nrow()

N <- n1 + n2

# Step 3: Approximate Z from p-value
# p.value comes from mw_result
z_approx <- qnorm(mw_result$p.value / 2, lower.tail = FALSE)

# Step 4: Calculate r
r_effect_size <- z_approx / sqrt(N)

# Step 5: Print result
cat("Mann-Whitney U result: W =", mw_result$statistic, 
    ", p =", signif(mw_result$p.value, 3), 
    ", r =", round(r_effect_size, 2), "\n")

```

# same for proportion of rep to total gesture
```{r}
# Mann-Whitney U for proportion of representative gestures
wilcox.test(prop_rep ~ groupstatus, 
            data = completely_merged_data_ALLyears, 
            exact = FALSE)

# Calculate N
n1 <- completely_merged_data_ALLyears %>% filter(groupstatus == "TD") %>% nrow()
n2 <- completely_merged_data_ALLyears %>% filter(groupstatus == "PL") %>% nrow()
N <- n1 + n2

# Run Mann-Whitney test
mw_result_prop <- wilcox.test(prop_rep ~ groupstatus, 
                              data = completely_merged_data_ALLyears, 
                              exact = FALSE)

# Approximate Z from p-value
z_approx_prop <- qnorm(mw_result_prop$p.value / 2, lower.tail = FALSE)

# Calculate r
r_effect_size_prop <- z_approx_prop / sqrt(N)

# Print results
cat("Mann-Whitney U result for proportion: W =", mw_result_prop$statistic, 
    ", p =", signif(mw_result_prop$p.value, 3), 
    ", r =", round(r_effect_size_prop, 2), "\n")

completely_merged_data_ALLyears %>%
  group_by(groupstatus) %>%
  summarise(Median_PropRep = median(prop_rep, na.rm = TRUE))


```

```{r}
# Load required libraries
library(dplyr)
library(gt)

# Create a summary table manually (based on your results so far)
mann_whitney_summary <- tibble::tibble(
  Outcome = c(
    "Total Gestures",
    "Number of Representational Gestures",
    "Proportion of Representational Gestures"
  ),
  W = c(802, 867, 615.5),
  p = c(0.235, 0.036, 0.011),
  r = c(0.13, 0.23, 0.29)
)

# Clean up for APA formatting
mann_whitney_summary <- mann_whitney_summary %>%
  mutate(
    p = ifelse(p < .001, "< .001", sprintf("%.3f", p)),
    r = sprintf("%.2f", r)
  )

# Create the APA-style table
mann_whitney_summary %>%
  gt() %>%
  tab_header(
    title = md("**Table X**"),
    subtitle = md("**Mann-Whitney U Test Results for Gesture Outcomes**")
  ) %>%
  cols_label(
    Outcome = "Outcome Variable",
    W = "W",
    p = "p",
    r = "Effect Size (r)"
  ) %>%
  tab_options(
    table.font.size = "small",
    table.align = "center",
    data_row.padding = px(2)
  )
# Note. W = Wilcoxon rank-sum statistic (equivalent to Mann-Whitney U); r = effect size
```


```{r}
# Load libraries
library(dplyr)
library(gt)

# Step 1: Create summary table
mann_whitney_summary <- tibble::tibble(
  Outcome = c(
    "Total Gestures",
    "Number of Representational Gestures",
    "Proportion of Representational Gestures"
  ),
  W = c(802, 867, 615.5),
  p_numeric = c(0.235, 0.036, 0.011),
  r = c(0.13, 0.23, 0.29)
)

# Step 2: Format nicely for APA
mann_whitney_summary <- mann_whitney_summary %>%
  mutate(
    p = ifelse(p_numeric < .001, "< .001", sprintf("%.3f", p_numeric)),
    r = sprintf("%.2f", r)
  )

# Step 3: Build APA table with bolded significant rows
mann_whitney_summary %>%
  select(Outcome, W, p, r, p_numeric) %>%  # Keep p_numeric for bolding condition
  gt() %>%
  tab_header(
    title = md("**Table X**"),
    subtitle = md("**Mann-Whitney U Test Results for Gesture Outcomes**")
  ) %>%
  cols_label(
    Outcome = "Outcome Variable",
    W = "W",
    p = "p",
    r = "Effect Size (r)"
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      rows = p_numeric < 0.05
    )
  ) %>%
  tab_options(
    table.font.size = "small",
    table.align = "center",
    data_row.padding = px(2)
  ) %>%
  cols_hide(columns = p_numeric)  # Hide helper column p_numeric

```


```{r}
# Mann-Whitney U Test (nonparametric equivalent to independent-samples t-test)
wilcox.test(rep_gestures ~ groupstatus, data = completely_merged_data_ALLyears)

#report medians (which is preferred for nonparametric tests)
completely_merged_data_ALLyears %>%
  group_by(groupstatus) %>%
  summarise(
    Median_RepGestures = median(rep_gestures, na.rm = TRUE),
    n = n()
  )

# Step 2a: Get N
n1 <- completely_merged_data_ALLyears %>%
  filter(groupstatus == "TD") %>%
  nrow()

n2 <- completely_merged_data_ALLyears %>%
  filter(groupstatus == "PL") %>%
  nrow()

N <- n1 + n2

# Step 2b: Approximate Z from p-value
# Two-tailed p-value, so divide by 2
z_approx <- qnorm(mw_result$p.value / 2, lower.tail = FALSE)

# Step 2c: Calculate r
r_effect_size <- z_approx / sqrt(N)

# Print it
r_effect_size



```

```{r}
library(ggplot2)

ggplot(completely_merged_data_ALLyears, aes(x = groupstatus, y = rep_gestures)) +
  
  # Boxplot
  geom_boxplot(fill = "gray80", color = "black", width = 0.6) +
  
  # Add individual data points
  geom_jitter(width = 0.1, height = 0, alpha = 0.5, size = 2) +
  
  # Labels
  labs(
    title = "Representational Gestures by Group Status",
    x = "Group Status",
    y = "Number of Representational Gestures"
  ) +
  
  # APA-style clean theme
  theme_minimal(base_size = 14, base_family = "Times New Roman") +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 0.8),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(face = "bold", hjust = 0.5),
    axis.title = element_text(face = "bold"),
    axis.text = element_text(color = "black"),
    legend.position = "none"
  )

```

```{r}
# Create binary variable: 0 = No rep gesture, 1 = At least one rep gesture
completely_merged_data_ALLyears <- completely_merged_data_ALLyears %>%
  mutate(rep_gesture_present = if_else(rep_gestures > 0, 1, 0))

# Bar plot
ggplot(completely_merged_data_ALLyears, aes(x = groupstatus, fill = factor(rep_gesture_present))) +
  geom_bar(position = "fill", color = "black") +
  scale_fill_manual(
    values = c("gray80", "black"),
    labels = c("Absent", "Present"),
    name = "Representational Gesture"
  ) +
  labs(
    title = "Proportion of Children Producing Representational Gestures",
    x = "Group Status",
    y = "Proportion"
  ) +
  theme_minimal(base_size = 14, base_family = "Times New Roman") +
  theme(
    panel.border = element_rect(color = "black", fill = NA),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.title = element_text(face = "bold"),
    legend.position = "bottom"
  )
#Figure 1. Proportion of children producing representational gestures during pretend play, by group status.```
```

# if want figure with individual measures
```{r}
ggplot(completely_merged_data_ALLyears, aes(x = groupstatus, y = rep_gestures)) +
  geom_jitter(width = 0.2, height = 0, alpha = 0.7, size = 2, color = "black") +
  labs(
    title = "Representational Gesture Counts by Group",
    x = "Group Status",
    y = "Number of Representational Gestures"
  ) +
  theme_minimal(base_size = 14, base_family = "Times New Roman") +
  theme(
    panel.border = element_rect(color = "black", fill = NA),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(face = "bold", hjust = 0.5),
    axis.title = element_text(face = "bold")
  )
#Figure 2. Individual participant counts of representational gestures during pretend play, grouped by group status.
```

# treat rep gestures as binary
```{r}
# Make sure rep_gesture_present is coded 0/1 (binary)
completely_merged_data_ALLyears <- completely_merged_data_ALLyears %>%
  mutate(rep_gesture_present = if_else(rep_gestures > 0, 1, 0))

# Create a table
table_group_gesture <- table(completely_merged_data_ALLyears$groupstatus, completely_merged_data_ALLyears$rep_gesture_present)

# Run chi-square test
chisq.test(table_group_gesture)
```

```{r}
library(ggplot2)
library(dplyr)

# Make sure rep_gesture_present is binary (0 = Absent, 1 = Present)
completely_merged_data_ALLyears <- completely_merged_data_ALLyears %>%
  mutate(rep_gesture_present = if_else(rep_gestures > 0, 1, 0))

# Create the bar plot
ggplot(completely_merged_data_ALLyears, aes(x = groupstatus, fill = factor(rep_gesture_present))) +
  
  geom_bar(position = "fill", color = "black") +
  
  scale_fill_manual(
    values = c("gray80", "black"),  # APA-style colors
    labels = c("Absent", "Present"),  # Legend labels
    name = "Representational Gesture Presence"
  ) +
  
  labs(
    title = "Proportion of Children Producing Representational Gestures",
    x = "Group Status",
    y = "Proportion"
  ) +
  
  theme_minimal(base_size = 14, base_family = "Times New Roman") +
  
  theme(
    panel.border = element_rect(color = "black", fill = NA),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(face = "bold", hjust = 0.5),
    axis.title = element_text(face = "bold"),
    legend.position = "bottom",
    axis.text = element_text(color = "black")
  )

```




# 1. Conduct ANOVAs for gestures & summarize results
```{r}
# For total gestures
total_anova <- aov(total_gestures ~ groupstatus, pp_gesture_data_ALLyears)
cat("\nTotal gestures ANOVA:\n")
print(summary(total_anova))

# For representational gestures
rep_anova <- aov(rep_gestures ~ groupstatus, data = pp_gesture_data_ALLyears)
cat("\nRepresentational gestures ANOVA:\n")
print(summary(rep_anova))
 
# For proportion of representational gestures to total gestures
prop_rep_anova <- aov(prop_rep ~ groupstatus, data = pp_gesture_data_ALLyears)
cat("\nProportion of representational gestures ANOVA:\n")
print(summary(prop_rep_anova))
```

# 2. Calculate effect sizes
```{r}
if(require(effectsize)) {
  cat("\nEffect sizes:\n")
  cat("Total gestures: ")
  print(eta_squared(total_anova))
  cat("Proportion representational: ")
  print(eta_squared(prop_rep_anova))
} else {
  # Manual calculation if package not available
  cat("\nEffect sizes calculated manually:\n")
  # Formula for eta-squared: SS_between / SS_total
  summary_total <- summary(total_anova)
  eta_sq_total <- summary_total[[1]]["GroupStatus", "Sum Sq"] / 
                 sum(summary_total[[1]][, "Sum Sq"])
  cat("Total gestures eta-squared: ", eta_sq_total, "\n")
  # Repeat for other ANOVAs
}
```

# 3. Descriptive statistics by group
```{r}
group_stats <- pp_gesture_data_ALLyears %>%
  group_by(groupstatus) %>%
  summarize(
    n = n(),
    total_mean = mean(total_gestures, na.rm = TRUE),
    total_sd = sd(total_gestures, na.rm = TRUE),
    rep_mean = mean(rep_gestures, na.rm = TRUE),
    rep_sd = sd(rep_gestures, na.rm = TRUE),
    prop_rep_mean = mean(prop_rep, na.rm = TRUE),
    prop_rep_sd = sd(prop_rep, na.rm = TRUE)
  )

print("Descriptive statistics by group:")
print(group_stats)
```

# 4. Visualization of results
```{r}
if(require(tidyverse)) {
  # Raw counts visualization
  counts_long <- pp_gesture_data_ALLyears %>%
    select(groupstatus, total_gestures, rep_gestures) %>%
    pivot_longer(cols = c(total_gestures, rep_gestures),
                names_to = "gesture_type", 
                values_to = "count")
  
  p1 <- ggplot(counts_long, aes(x = gesture_type, y = count, fill = groupstatus)) +
    stat_summary(fun = mean, geom = "bar", position = position_dodge(0.9)) +
    stat_summary(fun.data = function(x) {
      data.frame(y = mean(x, na.rm = TRUE),
                ymin = mean(x, na.rm = TRUE) - sd(x, na.rm = TRUE)/sqrt(sum(!is.na(x))),
                ymax = mean(x, na.rm = TRUE) + sd(x, na.rm = TRUE)/sqrt(sum(!is.na(x))))
    }, geom = "errorbar", width = 0.2, position = position_dodge(0.9)) +
    labs(title = "Mean Gesture Counts During Pretend Play by Group",
         x = "Gesture Type",
         y = "Mean Count",
         fill = "Group Status") +
    theme_minimal() +
    scale_x_discrete(labels = c("total_gestures" = "Total",
                               "rep_gestures" = "Representational"))
  print(p1)
  
  # Proportions visualization
  props_long <- pp_gesture_data_ALLyears %>%
    select(groupstatus, prop_rep) %>%
    pivot_longer(cols = c(prop_rep),
                names_to = "proportion_type", 
                values_to = "proportion")
  
  p2 <- ggplot(props_long, aes(x = proportion_type, y = proportion, fill = groupstatus)) +
    stat_summary(fun = mean, geom = "bar", position = position_dodge(0.9)) +
    stat_summary(fun.data = function(x) {
      data.frame(y = mean(x, na.rm = TRUE),
                ymin = mean(x, na.rm = TRUE) - sd(x, na.rm = TRUE)/sqrt(sum(!is.na(x))),
                ymax = mean(x, na.rm = TRUE) + sd(x, na.rm = TRUE)/sqrt(sum(!is.na(x))))
    }, geom = "errorbar", width = 0.2, position = position_dodge(0.9)) +
    labs(title = "Proportion of Gesture Types During Pretend Play by Group",
         x = "Proportion Type",
         y = "Mean Proportion",
         fill = "Group Status") +
    theme_minimal() +
    scale_x_discrete(labels = c("prop_rep" = "Representational/Total")) +
    scale_y_continuous(labels = scales::percent)
  print(p2)
}
```

# 5. Statistical tests to directly compare TD and BI groups
```{r}
# t-tests for each variable (alternative to ANOVA with only two groups)
t_total <- t.test(total_gestures ~ groupstatus, data = pp_gesture_data_ALLyears)
t_rep <- t.test(rep_gestures ~ groupstatus, data = pp_gesture_data_ALLyears)
t_prop_rep <- t.test(prop_rep ~ groupstatus, data = pp_gesture_data_ALLyears)

cat("\nt-test results (direct comparison between groups):\n")
cat("\nTotal gestures:\n")
print(t_total)
cat("\nRepresentational gestures:\n")
print(t_rep)
cat("\nProportion representational:\n")
print(t_prop_rep)
```

# 6. Calculate Cohen's d effect sizes for t-tests with error handling
```{r}

cat("\nCohen's d effect sizes:\n")

# Function to safely calculate Cohen's d
safe_cohens_d <- function(formula, data) {
  tryCatch({
    res <- cohens_d(formula, data = data)
    return(res)
  }, error = function(e) {
    # Extract variable name from formula
    var_name <- as.character(formula)[2]
    # Get means by group
    means <- aggregate(formula, data = data, FUN = mean, na.rm = TRUE)
    sds <- aggregate(formula, data = data, FUN = sd, na.rm = TRUE)
    
    cat("Error calculating Cohen's d for", var_name, ":\n")
    cat("Group means:", toString(means), "\n")
    cat("Group SDs:", toString(sds), "\n")
    cat("Error message:", e$message, "\n")
    return(NULL)
  })
}

# Apply the safe function to each variable
cat("\nTotal gestures:\n")
print(safe_cohens_d(total_gestures ~ groupstatus, data = pp_gesture_data_ALLyears))

cat("\nRepresentational gestures:\n")
print(safe_cohens_d(rep_gestures ~ groupstatus, data = pp_gesture_data_ALLyears))

cat("\nProportion representational:\n")
print(safe_cohens_d(prop_rep ~ groupstatus, data = pp_gesture_data_ALLyears))
```

# Make APA-formatted data visualizations
```{r}
if(require(tidyverse)) {
  # Set APA theme
  apa_theme <- theme_bw() +
    theme(
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      panel.border = element_rect(colour = "black", fill = NA),
      axis.text = element_text(colour = "black", size = 12),
      axis.title = element_text(size = 12, face = "bold"),
      legend.title = element_text(size = 12, face = "bold"),
      legend.text = element_text(size = 12),
      legend.position = "bottom",
      legend.background = element_rect(fill = "white", colour = "black"),
      plot.title = element_text(size = 14, hjust = 0.5, face = "bold"),
      text = element_text(family = "Times New Roman")
    )
  
  # Raw counts visualization
  counts_long <- pp_gesture_data_ALLyears %>%
    select(groupstatus, total_gestures, rep_gestures) %>%
    pivot_longer(cols = c(total_gestures, rep_gestures),
                names_to = "gesture_type", 
                values_to = "count")
  
  # Renaming GroupStatus labels to be more readable
  counts_long$groupstatus <- factor(counts_long$groupstatus, 
                                  levels = c("PL", "TD"),
                                  labels = c("Perinatal Lesions", "Typically Developing"))
  
  p1 <- ggplot(counts_long, aes(x = gesture_type, y = count, fill = groupstatus)) +
    stat_summary(fun = mean, geom = "bar", position = position_dodge(0.8), 
                alpha = 0.8, color = "black", size = 0.2) +
    stat_summary(fun.data = function(x) {
      data.frame(y = mean(x, na.rm = TRUE),
                ymin = mean(x, na.rm = TRUE) - sd(x, na.rm = TRUE)/sqrt(sum(!is.na(x))),
                ymax = mean(x, na.rm = TRUE) + sd(x, na.rm = TRUE)/sqrt(sum(!is.na(x))))
    }, geom = "errorbar", width = 0.2, position = position_dodge(0.8)) +
    labs(title = "Figure 1",
         subtitle = "Mean Gesture Counts During Pretend Play by Group",
         x = "Gesture Type",
         y = "Mean Count",
         fill = "Group") +
    scale_x_discrete(labels = c("total_gestures" = "Total",
                               "rep_gestures" = "Representational")) +
    scale_fill_grey(start = 0.4, end = 0.8) +
    apa_theme +
    theme(plot.subtitle = element_text(size = 12, hjust = 0.5))
  
  print(p1)
  
  # Save high-resolution figure
  ggsave("Figure_1_Gesture_Counts.tiff", p1, width = 7, height = 5, dpi = 300)
  
  # Proportions visualization
  props_long <- pp_gesture_data_ALLyears %>%
    select(groupstatus, prop_rep) %>%
    pivot_longer(cols = c(prop_rep),
                names_to = "proportion_type", 
                values_to = "proportion")
  
  # Renaming GroupStatus labels
  props_long$groupstatus <- factor(props_long$groupstatus, 
                                  levels = c("PL", "TD"),
                                  labels = c("Perinatal Lesions", "Typically Developing"))
  
  p2 <- ggplot(props_long, aes(x = proportion_type, y = proportion, fill = groupstatus)) +
    stat_summary(fun = mean, geom = "bar", position = position_dodge(0.8), 
                alpha = 0.8, color = "black", size = 0.2) +
    stat_summary(fun.data = function(x) {
      data.frame(y = mean(x, na.rm = TRUE),
                ymin = mean(x, na.rm = TRUE) - sd(x, na.rm = TRUE)/sqrt(sum(!is.na(x))),
                ymax = mean(x, na.rm = TRUE) + sd(x, na.rm = TRUE)/sqrt(sum(!is.na(x))))
    }, geom = "errorbar", width = 0.2, position = position_dodge(0.8)) +
    labs(title = "Figure 2", 
         subtitle = "Proportion of Gesture Types During Pretend Play by Group",
         x = "Proportion Type",
         y = "Mean Proportion",
         fill = "Group") +
    scale_x_discrete(labels = c("prop_rep" = "Representational/Total")) +
    scale_y_continuous(labels = scales::percent, 
                      breaks = seq(0, 0.25, 0.05)) +
    scale_fill_grey(start = 0.4, end = 0.8) +
    apa_theme +
    theme(plot.subtitle = element_text(size = 12, hjust = 0.5))
  
  print(p2)
  
  # Save high-resolution figure
  ggsave("Figure_2_Gesture_Proportions.tiff", p2, width = 7, height = 5, dpi = 300)
}
```
# Is rep_gestures positively correlated with total_gestures (overall gestures produced during pretend play)?
```{r}
cor.test(completely_merged_data_ALLyears$rep_gestures, completely_merged_data_ALLyears$total_gestures)

```

# boxplot of representational gesture presence & narrative score
```{r}
# First: recode rep_gestures as a factor for clean labeling
completely_merged_data_ALLyears <- completely_merged_data_ALLyears %>%
  mutate(rep_gesture_factor = factor(rep_gesture_present, levels = c(0,1), labels = c("Absent", "Present")))

# Plot
ggplot(completely_merged_data_ALLyears, aes(x = rep_gesture_factor, y = max_avg)) +
  geom_boxplot(fill = "gray80", color = "black") +
  stat_summary(fun = mean, geom = "point", size = 3, color = "black", position = position_dodge(width=0.75)) +
  labs(
    x = "Representational Gesture",
    y = "Narrative Structure Score",
    title = "Narrative Structure by Representational Gesture Presence"
  ) +
  theme_minimal(base_size = 14, base_family = "Times New Roman") +
  theme(
    panel.border = element_rect(color = "black", fill = NA),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.title = element_text(face = "bold")
  )

```


```{r}
library(ggplot2)
library(dplyr)

# Recode rep_gestures as a factor for clean group labels
completely_merged_data_ALLyears <- completely_merged_data_ALLyears %>%
  mutate(rep_gesture_factor = factor(rep_gesture_present, levels = c(0, 1),
                                     labels = c("Absent", "Present")))

# Bar graph with error bars (mean ± SE)
ggplot(completely_merged_data_ALLyears, aes(x = rep_gesture_factor, y = max_avg)) +
  
  # Bar for mean narrative scores
  stat_summary(fun = mean, geom = "bar", fill = "gray80", color = "black", width = 0.6) +
  
  # Error bars (± standard error)
  stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.2, color = "black", size = 0.8) +
  
  # Points for individual data points (optional, adds transparency)
  geom_jitter(width = 0.1, height = 0, size = 2, alpha = 0.5) +
  
  # Labels
  labs(
    title = "Narrative Structure by Representational Gesture Presence",
    x = "Representational Gesture Presence",
    y = "Narrative Structure Score"
  ) +
  
  # APA-style theme
  theme_minimal(base_size = 14, base_family = "Times New Roman") +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_rect(color = "black", fill = NA, size = 0.8),
    axis.line = element_line(color = "black"),
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.title = element_text(face = "bold"),
    legend.position = "none"
  )

#Figure 1
#Mean narrative structure scores for children who did versus did not produce representational gestures during pretend play. Error bars represent ±1 standard error of the mean. Children who produced representational gestures had marginally higher narrative structure scores compared to those who did not (p = .075).

```

```{r}
completely_merged_data_ALLyears %>%
  group_by(rep_gesture_factor) %>%
  summarise(
    Mean_Narrative = mean(max_avg, na.rm = TRUE),
    SD_Narrative = sd(max_avg, na.rm = TRUE),
    n = n()
  )

```

```{r}
# Identify participants with missing rep_gestures
completely_merged_data_ALLyears %>%
  filter(is.na(rep_gestures)) %>%
  select(participant_id, total_gestures, rep_gestures, everything())

# List all unique values
unique(completely_merged_data_ALLyears$rep_gestures)

# Find participants with rep_gestures not equal to 0 or 1
completely_merged_data_ALLyears %>%
  filter(!(rep_gestures %in% c(0, 1))) %>%
  select(participant_id, rep_gestures)

```

