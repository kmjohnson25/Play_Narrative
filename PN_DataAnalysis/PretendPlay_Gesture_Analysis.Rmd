---
title: "PretendPlay_Gesture_Analysis"
author: "Kristen Johnson"
date: "2025-04-02"
output:
  pdf_document: default
  html_document: default
---
```{r, echo=FALSE}
# Install required packages if you don't have them
# Remove the comment symbols (#) to run these lines
# install.packages("tidyverse")
 install.packages("car")
 install.packages("effectsize")
 install.packages("rstatix")

# Load necessary packages
library(tidyverse)
library(car)       # For Levene's test and Type III SS
library(effectsize) # For effect sizes
library(rstatix)    # For convenient statistical functions
```

# My data is in a dataframe called 'merged_[timepoint]' with columns:
## - GroupStatus: Factor with levels "TD" and "PL"
## - gesture_all: Count of all gestures
## - gesture_rep: Count of representational gestures
## - gesture_icon: Count of iconic gestures
## - C-wpu: Language ability measure
## - c_pret: Frequency of pretend play instances

# 1. Check the correlations between your gesture variables
```{r, echo=FALSE}
merged_H8 <- read.csv("~/KristenWorkingDirectory/Play_Narrative/PN_Datasets/Pretend_Play/CSVs_of_Combined_Data_PP/merged_H8.csv")

cor_matrix <- cor(merged_H8[, c("gesture_all", "gesture_rep", "gesture_icon")])
print(cor_matrix)
```


# 2. Conduct Univariate analyses for each gesture type
```{r, echo=FALSE}
# This avoids the multicollinearity issue

# For total gestures
total_aov <- aov(gesture_all ~ GroupStatus, data = merged_H8)
cat("\nTotal gestures ANOVA:\n")
print(summary(total_aov))

# For representational gestures
rep_aov <- aov(gesture_rep ~ GroupStatus, data = merged_H8)
cat("\nRepresentational gestures ANOVA:\n")
print(summary(rep_aov))

# For iconic gestures
icon_aov <- aov(gesture_icon ~ GroupStatus, data = merged_H8)
cat("\nIconic gestures ANOVA:\n")
print(summary(icon_aov))
```

# 3. Descriptive statistics by group
```{r, echo=FALSE}
group_stats <- aggregate(cbind(gesture_all, gesture_rep, gesture_icon) ~ GroupStatus, 
                         data = merged_H8, 
                         FUN = function(x) c(mean = mean(x, na.rm = TRUE), 
                                             sd = sd(x, na.rm = TRUE),
                                             n = sum(!is.na(x))))
print(group_stats)
```

# 4. Calculate effect sizes for ANOVAs
```{r, echo=FALSE}
if(require(effectsize)) {
  cat("\nEffect sizes:\n")
  cat("Total gestures: ")
  print(eta_squared(total_aov))
  cat("Representational gestures: ")
  print(eta_squared(rep_aov))
  cat("Iconic gestures: ")
  print(eta_squared(icon_aov))
} else {
  # Manual effect size calculation if effectsize package is not available
  SS_total <- sum((total_aov$model$gesture_all - mean(total_aov$model$gesture_all))^2)
  SS_effect <- sum(tapply(total_aov$model$gesture_all, 
                         total_aov$model$GroupStatus, 
                         function(x) length(x) * (mean(x) - mean(total_aov$model$gesture_all))^2))
  cat("\nTotal gestures eta-squared: ", SS_effect/SS_total, "\n")
  
  # Similar calculations could be done for other variables
}
```

# 5. Visualization 
```{r, echo=FALSE}
# Create a long-format dataset for plotting
data_long <- merged_H8 %>%
  select(GroupStatus, gesture_all, gesture_rep, gesture_icon) %>%
  pivot_longer(cols = c(gesture_all, gesture_rep, gesture_icon),
              names_to = "gesture_type", 
              values_to = "count")

# Plot means with error bars
ggplot(data_long, aes(x = gesture_type, y = count, fill = GroupStatus)) +
  stat_summary(fun = mean, geom = "bar", position = position_dodge(0.9)) +
  stat_summary(fun.data = \(x) {
    data.frame(y = mean(x, na.rm = TRUE),
               ymin = mean(x, na.rm = TRUE) - sd(x, na.rm = TRUE)/sqrt(length(x)),
               ymax = mean(x, na.rm = TRUE) + sd(x, na.rm = TRUE)/sqrt(length(x)))
  }, geom = "errorbar", width = 0.2, position = position_dodge(0.9)) +
  labs(title = "Mean Gesture Counts by Type and Group",
       x = "Gesture Type",
       y = "Mean Count",
       fill = "Group Status") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set1") +
  scale_x_discrete(labels = c("gesture_all" = "Total",
                             "gesture_rep" = "Representational",
                             "gesture_icon" = "Iconic"))
```
